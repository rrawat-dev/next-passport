{"ast":null,"code":"var passport = require('passport');\n\nvar LocalStrategy = require('passport-local').Strategy;\n\nvar cookieSession = require('cookie-session');\n\npassport.use(new LocalStrategy(function (username, password, done) {\n  console.log('authenticate ');\n\n  if (username === 'rakesh' && password === 'rawat') {\n    done(null, {\n      id: 'xxx'\n    });\n  } else {\n    done('error', null);\n  }\n}));\npassport.serializeUser(function (user, done) {\n  done(null, user.id);\n});\npassport.deserializeUser(function (id, done) {\n  done(err, {\n    id: 'xxx'\n  });\n});\n\nasync function handler(req, res) {\n  console.log('API CALLED');\n  await runMiddleware(req, res, cookieSession({\n    session: 'sid',\n    keys: ['aaaa'],\n    secure: false,\n    httpOnly: true\n  }));\n  await runMiddleware(req, res, passport.initialize());\n  await runMiddleware(req, res, passport.session());\n  console.log('MIDDLEWARE RAN', req.session);\n  passport.authenticate('local', (err, result) => {\n    console.log('AUTHENTICATION RAN', result);\n    req.session = result; // Rest of the API logic\n\n    res.json({\n      message: 'Hello Everyone!'\n    });\n  })(req, res);\n}\n\nexport default handler;","map":{"version":3,"sources":["/Users/rakrawat/workspace/next-passport/pages/api/login.js"],"names":["passport","require","LocalStrategy","Strategy","cookieSession","use","username","password","done","console","log","id","serializeUser","user","deserializeUser","err","handler","req","res","runMiddleware","session","keys","secure","httpOnly","initialize","authenticate","result","json","message"],"mappings":"AAAA,IAAIA,QAAQ,GAAGC,OAAO,CAAC,UAAD,CAAtB;;AACA,IAAIC,aAAa,GAAGD,OAAO,CAAC,gBAAD,CAAP,CAA0BE,QAA9C;;AACA,IAAIC,aAAa,GAAGH,OAAO,CAAC,gBAAD,CAA3B;;AAEAD,QAAQ,CAACK,GAAT,CAAa,IAAIH,aAAJ,CACT,UAASI,QAAT,EAAmBC,QAAnB,EAA6BC,IAA7B,EAAmC;AAC/BC,EAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;;AACA,MAAIJ,QAAQ,KAAK,QAAb,IAAyBC,QAAQ,KAAK,OAA1C,EAAmD;AAC/CC,IAAAA,IAAI,CAAC,IAAD,EAAO;AAACG,MAAAA,EAAE,EAAE;AAAL,KAAP,CAAJ;AACH,GAFD,MAEO;AACHH,IAAAA,IAAI,CAAC,OAAD,EAAU,IAAV,CAAJ;AACH;AACJ,CARQ,CAAb;AAWAR,QAAQ,CAACY,aAAT,CAAuB,UAASC,IAAT,EAAeL,IAAf,EAAqB;AACxCA,EAAAA,IAAI,CAAC,IAAD,EAAOK,IAAI,CAACF,EAAZ,CAAJ;AACH,CAFD;AAIAX,QAAQ,CAACc,eAAT,CAAyB,UAASH,EAAT,EAAaH,IAAb,EAAmB;AACxCA,EAAAA,IAAI,CAACO,GAAD,EAAM;AAACJ,IAAAA,EAAE,EAAE;AAAL,GAAN,CAAJ;AACH,CAFD;;AAMA,eAAeK,OAAf,CAAuBC,GAAvB,EAA4BC,GAA5B,EAAiC;AAC7BT,EAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ;AAEA,QAAMS,aAAa,CAACF,GAAD,EAAMC,GAAN,EAAWd,aAAa,CAAC;AACxCgB,IAAAA,OAAO,EAAE,KAD+B;AAExCC,IAAAA,IAAI,EAAE,CAAC,MAAD,CAFkC;AAGxCC,IAAAA,MAAM,OAHkC;AAIxCC,IAAAA,QAAQ,EAAE;AAJ8B,GAAD,CAAxB,CAAnB;AAOA,QAAMJ,aAAa,CAACF,GAAD,EAAMC,GAAN,EAAWlB,QAAQ,CAACwB,UAAT,EAAX,CAAnB;AACA,QAAML,aAAa,CAACF,GAAD,EAAMC,GAAN,EAAWlB,QAAQ,CAACoB,OAAT,EAAX,CAAnB;AAEAX,EAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ,EAA8BO,GAAG,CAACG,OAAlC;AAEApB,EAAAA,QAAQ,CAACyB,YAAT,CACI,OADJ,EAEI,CAACV,GAAD,EAAMW,MAAN,KAAiB;AACbjB,IAAAA,OAAO,CAACC,GAAR,CAAY,oBAAZ,EAAkCgB,MAAlC;AACAT,IAAAA,GAAG,CAACG,OAAJ,GAAcM,MAAd,CAFa,CAGb;;AACAR,IAAAA,GAAG,CAACS,IAAJ,CAAS;AAAEC,MAAAA,OAAO,EAAE;AAAX,KAAT;AACH,GAPL,EAQEX,GARF,EAQOC,GARP;AASH;;AAED,eAAeF,OAAf","sourcesContent":["var passport = require('passport');\nvar LocalStrategy = require('passport-local').Strategy;\nvar cookieSession = require('cookie-session')\n\npassport.use(new LocalStrategy(\n    function(username, password, done) {\n        console.log('authenticate ');\n        if (username === 'rakesh' && password === 'rawat') {\n            done(null, {id: 'xxx'});\n        } else {\n            done('error', null);\n        }\n    }\n));\n\npassport.serializeUser(function(user, done) {\n    done(null, user.id);\n});\n  \npassport.deserializeUser(function(id, done) {\n    done(err, {id: 'xxx'});\n});\n\n\n  \nasync function handler(req, res) {\n    console.log('API CALLED');\n\n    await runMiddleware(req, res, cookieSession({\n        session: 'sid',\n        keys: ['aaaa'],\n        secure: process.env.NODE_ENV === 'production',\n        httpOnly: true\n    }))\n\n    await runMiddleware(req, res, passport.initialize())\n    await runMiddleware(req, res, passport.session())\n\n    console.log('MIDDLEWARE RAN', req.session);\n\n    passport.authenticate(\n        'local',\n        (err, result) => {\n            console.log('AUTHENTICATION RAN', result);\n            req.session = result;\n            // Rest of the API logic\n            res.json({ message: 'Hello Everyone!' })\n        }\n    )(req, res);\n}\n  \nexport default handler"]},"metadata":{},"sourceType":"module"}