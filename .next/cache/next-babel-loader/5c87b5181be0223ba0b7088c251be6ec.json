{"ast":null,"code":"var passport = require('../../middlewares/passport');\n\nvar LocalStrategy = require('passport-local').Strategy;\n\nvar middleware = require('../../middlewares/passport');\n\npassport.use(new LocalStrategy(function (username, password, done) {\n  console.log('authenticate ');\n\n  if (username === 'rakesh' && password === 'rawat') {\n    done(null, {\n      id: 'xxx'\n    });\n  } else {\n    done('error', null);\n  }\n}));\n\nasync function handler(req, res) {\n  console.log('API CALLED');\n  middleware.runMiddleware(req, res).then(({\n    req,\n    res\n  }) => {\n    console.log('MIDDLEWARE RAN', req.session);\n    passport.authenticate('local', (err, result) => {\n      console.log('AUTHENTICATION RAN', result);\n      req.session = result; // Rest of the API logic\n\n      res.json({\n        message: 'Hello Everyone!'\n      });\n    })(req, res);\n  });\n}\n\nexport default handler;","map":{"version":3,"sources":["/Users/rakrawat/workspace/next-passport/pages/api/login.js"],"names":["passport","require","LocalStrategy","Strategy","middleware","use","username","password","done","console","log","id","handler","req","res","runMiddleware","then","session","authenticate","err","result","json","message"],"mappings":"AAAA,IAAIA,QAAQ,GAAGC,OAAO,CAAC,4BAAD,CAAtB;;AACA,IAAIC,aAAa,GAAGD,OAAO,CAAC,gBAAD,CAAP,CAA0BE,QAA9C;;AACA,IAAIC,UAAU,GAAGH,OAAO,CAAC,4BAAD,CAAxB;;AAEAD,QAAQ,CAACK,GAAT,CAAa,IAAIH,aAAJ,CACT,UAASI,QAAT,EAAmBC,QAAnB,EAA6BC,IAA7B,EAAmC;AAC/BC,EAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;;AACA,MAAIJ,QAAQ,KAAK,QAAb,IAAyBC,QAAQ,KAAK,OAA1C,EAAmD;AAC/CC,IAAAA,IAAI,CAAC,IAAD,EAAO;AAACG,MAAAA,EAAE,EAAE;AAAL,KAAP,CAAJ;AACH,GAFD,MAEO;AACHH,IAAAA,IAAI,CAAC,OAAD,EAAU,IAAV,CAAJ;AACH;AACJ,CARQ,CAAb;;AAWA,eAAeI,OAAf,CAAuBC,GAAvB,EAA4BC,GAA5B,EAAiC;AAC7BL,EAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ;AAEAN,EAAAA,UAAU,CAACW,aAAX,CAAyBF,GAAzB,EAA8BC,GAA9B,EAAmCE,IAAnC,CAAwC,CAAC;AAACH,IAAAA,GAAD;AAAMC,IAAAA;AAAN,GAAD,KAAgB;AACpDL,IAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ,EAA8BG,GAAG,CAACI,OAAlC;AAEAjB,IAAAA,QAAQ,CAACkB,YAAT,CACI,OADJ,EAEI,CAACC,GAAD,EAAMC,MAAN,KAAiB;AACbX,MAAAA,OAAO,CAACC,GAAR,CAAY,oBAAZ,EAAkCU,MAAlC;AACAP,MAAAA,GAAG,CAACI,OAAJ,GAAcG,MAAd,CAFa,CAGb;;AACAN,MAAAA,GAAG,CAACO,IAAJ,CAAS;AAAEC,QAAAA,OAAO,EAAE;AAAX,OAAT;AACH,KAPL,EAQET,GARF,EAQOC,GARP;AASH,GAZD;AAaH;;AAED,eAAeF,OAAf","sourcesContent":["var passport = require('../../middlewares/passport');\nvar LocalStrategy = require('passport-local').Strategy;\nvar middleware = require('../../middlewares/passport');\n\npassport.use(new LocalStrategy(\n    function(username, password, done) {\n        console.log('authenticate ');\n        if (username === 'rakesh' && password === 'rawat') {\n            done(null, {id: 'xxx'});\n        } else {\n            done('error', null);\n        }\n    }\n));\n  \nasync function handler(req, res) {\n    console.log('API CALLED');\n\n    middleware.runMiddleware(req, res).then(({req, res}) => {\n        console.log('MIDDLEWARE RAN', req.session);\n\n        passport.authenticate(\n            'local',\n            (err, result) => {\n                console.log('AUTHENTICATION RAN', result);\n                req.session = result;\n                // Rest of the API logic\n                res.json({ message: 'Hello Everyone!' })\n            }\n        )(req, res);\n    });\n}\n  \nexport default handler"]},"metadata":{},"sourceType":"module"}